<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
<title>Yilan APP</title>

<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery.mobile-1.3.2.min.js"></script>
<script src="phonegap.js"></script>
<script src="js/gmap.js"></script>


<link rel="stylesheet" href="css/mytheme.min.css" />
<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.min.css" />
<link href="css/layout.css" rel="stylesheet" type="text/css">

<script>



	var babyDaycareCenter = [{name:'宜蘭縣政府委託台灣嬰幼兒潛能發展協會辦理公共托嬰中心-宜蘭中心',lng:'121.75074',lat:'24.76167',address :' 宜蘭市同慶街95號2樓',phone:'039356393'}
,{name:'宜蘭縣私立巧天地托嬰中心',lng:'121.75670',lat:'24.76288',address :' 宜蘭市力行街力行巷9-1號',phone:'039333115'}
,{name:'宜蘭縣私立達文西托嬰中心',lng:'121.74508',lat:'24.75373',address :' 宜蘭市泰山路85巷7號',phone:'039363068'}
,{name:'宜蘭縣政府委託財團法人天主教蘭陽青年會辦理公共托嬰中心-羅東中心',lng:'121.75741',lat:'24.67606',address :' 羅東鎮北成路一段189號',phone:'039519359'}
,{name:'宜蘭縣私立娃娃屋托嬰中心',lng:'121.75985',lat:'24.6755',address :' 羅東鎮北成路一段102之1號',phone:'039616832'}
,{name:'宜蘭縣私立龍之堡托嬰中心',lng:'121.76390',lat:'24.68123',address :' 宜蘭縣羅東鎮公正路300巷25號',phone:'039557685'}
,{name:'宜蘭縣私立小豆苗托嬰中心',lng:'121.77452',lat:'24.67361',address :' 宜蘭縣羅東鎮站前南路280號3樓',phone:'039561556'}
,{name:'宜蘭縣私立貝蒂托嬰中心',lng:'121.80060',lat:'24.68616',address :' 五結鄉五結路二段322號',phone:'039509066'}
,{name:'宜蘭縣私立喜園托嬰中心',lng:'121.76950',lat:'24.69956',address :' 五結鄉上四村中正東路72巷10號',phone:'039656966'}
,{name:'宜蘭縣私立耕喬寶寶學園托嬰中心',lng:'121.77081',lat:'24.69109',address :' 五結鄉隆昌路21號',phone:'039549557'}
,{name:'宜蘭縣政府委託台灣嬰幼兒潛能發展協會辦理公共托嬰中心-礁溪中心',lng:'121.76960',lat:'24.82081',address :' 礁溪鄉礁溪路四段126號3樓',phone:'039871993'}];
	var motherBabyCenter =	[{name:'聖母醫院',lng:'121.77157',lat:'24.67183',address :' 宜蘭縣羅東鎮中正南路160號',phone:'039544106'}
,{name:'博愛醫院',lng:'121.77316',lat:'24.67169',address :' 宜蘭縣羅東鎮南昌街83號',phone:'039543131'}
,{name:'陽明大學附設醫院',lng:'121.75416',lat:'24.75777',address :' 宜蘭市新民路152號',phone:'039051688'}
];
	var healthCenter =	[{name:'宜蘭市衛生所',lng:'121.75307',lat:'24.74925',address :' 宜蘭縣宜蘭市復興路一段３號',phone:'(03)9322362'}
,{name:'羅東鎮衛生所',lng:'121.767',lat:'24.67755',address :' 宜蘭縣羅東鎮民生路 79號',phone:'(03)9542321'}
,{name:'蘇澳鎮衛生所',lng:'121.84151',lat:'24.59406',address :' 蘇澳鎮志成路六十號',phone:'(03)9962486'}
,{name:'頭城鎮衛生所',lng:'121.82048',lat:'24.85673',address :' 宜蘭縣頭城鎮新建里新興路 304 號',phone:'(03)9771034'}
,{name:'礁溪鄉衛生所',lng:'121.7696',lat:'24.82081',address :' 宜蘭縣礁溪鄉礁溪路四段126號B1',phone:'(03)9882908'}
,{name:'壯圍鄉衛生所',lng:'121.78656',lat:'24.74701',address :' 宜蘭縣壯圍鄉吉祥村中央路二段290號',phone:'(03)9385503'}
,{name:'員山鄉衛生所',lng:'121.72432',lat:'24.74442',address :' 宜蘭縣員山鄉復興路2號',phone:'(03)9226147'}
,{name:'冬山鄉衛生所',lng:'121.79152',lat:'24.63609',address :' 宜蘭縣冬山鄉冬山村中正路16號',phone:'(03)9591140'}
,{name:'五結鄉衛生所',lng:'121.79891',lat:'24.68488',address :' 宜蘭縣五結鄉五結村五結路二段337號',phone:'(03)9600040'}
,{name:'三星鄉衛生所',lng:'121.65157',lat:'24.66613',address :' 三星鄉三星路五段70號',phone:'(03)9893541'}
,{name:'大同鄉衛生所',lng:'121.60885',lat:'24.67786',address :' 宜蘭縣大同鄉崙埤村朝陽40號',phone:'(03)9801175'}
,{name:'南澳鄉衛生所',lng:'121.80353',lat:'24.46582',address :' 宜蘭縣南澳鄉南澳村蘇花路二段375號',phone:'(03)9981019'}
];


var vaccineData = [{"month":1, "name":["卡介苗第一劑", "B 型肝炎疫苗第一劑", "B 型肝炎疫苗第二劑"]},
               {"month":2, "name":["白喉破傷風非細胞性百日咳、b 型嗜血桿菌及不活化小兒麻痺五合一疫苗第一劑"]},
               {"month":4, "name":["白喉破傷風非細胞性百日咳、b 型嗜血桿菌及不活化小兒麻痺五合一疫苗第二劑"]},
               {"month":6, "name":["B 型肝炎疫苗第三劑", "白喉破傷風非細胞性百日咳、b 型嗜血桿菌及不活化小兒麻痺五合一疫苗第三劑","流感疫苗第一劑","流感疫苗第二劑"]},
               {"month":12, "name":["水痘疫苗第一劑", "麻疹腮腺炎德國麻疹混合疫苗第一劑"]},
               {"month":15, "name":["日本腦炎疫苗第一劑", "日本腦炎疫苗第二劑"]},
               {"month":18, "name":["白喉破傷風非細胞性百日咳、b 型嗜血桿菌及不活化小兒麻痺五合一疫苗第四劑","流感疫苗一劑"]},
               {"month":24, "name":["A 型肝炎疫苗第一劑"]},
               {"month":27, "name":["日本腦炎疫苗第三劑"]},
               {"month":30, "name":["A 型肝炎疫苗第二劑","流感疫苗一劑"]},
               {"month":42, "name":["流感疫苗一劑"]},
               {"month":60, "name":["減量破傷風白喉非細胞性百日咳及不活化小兒麻痺混合疫苗一劑","流感疫苗一劑"]}];



		
	var defaultLatLng = new google.maps.LatLng(24.73071, 121.76312); // Yilan Government 
	var currentLatLng = defaultLatLng;	
	
	function initialize(successCallback)
	{
			if (navigator.geolocation)
			{
				navigator.geolocation.getCurrentPosition(
					successCallback,
					function(error) {}			
				);
			}
			else
			{
				// 改 alert $("#msg").html("System can't get your geolocation. Your location will automatically set on Yilan government!");
			}
	}

	function setCurrentLatLng(position){
		currentLatLng =  new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
	}	
	
	$(function(){

			// 下面參數沒有被使用
			var homePage = $("#home div[data-role='content']");
			var listPage = $("#listpage div[data-role='content']");
			var vaccinepage = $("#vaccinepage div[data-role='content']");

			initialize(setCurrentLatLng); // 初始現在座標

			// 首頁功能
			var now_data_file; // 目前點選的資料
			var now_select_location; // 目前選擇地點
			
			homePage.find("a").click(function(){
				switch( $(this).attr("data-tag") )
				{
					case "milk":
					  now_data_file = babyDaycareCenter;
					  break;
					case 2:
					  
					  break;
					default:					  
				}
			});
			





			// ListPage page show
			$("#listpage").bind('pageshow',function(){

				for(var i=0; i< now_data_file.length; i++){	

					var list_li = $('<li data-iconpos="left">');
					var list_a = $("<a href='#selectDialog' data-rel='dialog' data-transition='pop' class='ui-link-inherit' data-param='"+JSON.stringify(now_data_file[i])+"'>")
						.click(function(){
							now_select_location = $.parseJSON($(this).attr("data-param"));
						});
						
					var list_text = $('<div class="ui-btn-text">');
				
					list_text
						//.append('<img src="images/list.png" class="ui-li-icon">')
						.append('<h3 class="ui-li-heading">'+now_data_file[i].name+'</h3>')
						.append('<p class="ui-li-desc"> '+ now_data_file[i].address + '<br/>' + now_data_file[i].phone +'</p>')
						.appendTo(list_a);
					
					list_a.appendTo(list_li);
					list_li.appendTo("#recent");
						//$("<li>").html(now_data_file[i].name).appendTo("#recent");
				}
				$("#recent").listview("refresh");
			});
			








			//apply overrides here
			$("#selectDialog").bind('pageshow',function(){
				$(this).find("a[data-tag='navigation']").attr("href","http://maps.google.com/maps?daddr="+ currentLatLng.lat() +","+ currentLatLng.lng() +"&saddr="+ now_select_location.lat +","+ now_select_location.lng);
				$(this).find("a[data-tag='phonecall']").attr("href","tel:"+now_select_location.phone);
				//$(this).find("a[data-tag='mylove'").attr("");
			});





			//name:  vaccineData   format: [ {"month":1, "name":["卡介苗第一劑", "B 型肝炎疫苗第一劑", "B 型肝炎疫苗第二劑"]}, ...]
			// 接種疫苗 page 事件 vaccinePage page show
			// 記錄寶寶出生年月日對話框
			var month = localStorage.getItem("month");
			$("#submit").bind('click',function(){
				var name=$('#babyname').val();
				var birthday=$('#babybirthday').val();
				
				if(name=="")
					alert("請輸入寶寶名稱");
				else if(birthday=="")
					alert("請選擇寶寶出生日期");
				else{

					var bd = birthday.split("-");
					localStorage.setItem("year",bd[0]); 
					localStorage.setItem("month",bd[1]); 
					localStorage.setItem("day",bd[2]); 
					localStorage.setItem("name", $("#babyname").val());

					$.mobile.changePage("#vaccinepage", "slide", false, true);	
					
					}



			});

			$("#vaccinepage").bind('pageshow',function(){
				month = localStorage.getItem("month");
				
				if(month == null){
					$('#lnkDialog').click();
				}
				else{
					
					for(var i=0; i< vaccineData.length; i++){	

					var list_li_der = $('<li data-role="list-divider" data-theme="a">');
						list_li_der.append('<h3 class="ui-li-heading">' + vaccineData[i].month + '個月後接種</h3>');
						list_li_der.appendTo("#vaccineList");
					var list_name = vaccineData[i].name;
							for(var j=0; j< list_name.length; j++){	
									var list_li = $('<li>');
									var list_a = $("<a href='#'>");
									var list_text = $('<div class="ui-btn-text">');
									list_text.append('<h3 class="ui-li-heading">'+list_name[j]+'</h3>').appendTo(list_a);
									list_a.appendTo(list_li);
									list_li.appendTo("#vaccineList");
							}
					}
					$("#vaccineList").listview("refresh");

				}

					
				});




				





				





		






	});
</script>

</head>

<body>


<!-- home page 以 jQuery mobile Grid 切版 顯示所有功能 -->
<div data-role="page" id="home" data-theme="a">
  <div data-role="content"> 


  <div class="ui-grid-a">
	<div class="ui-block-a">
		 
			<a href="#listpage" data-tag="milk"><div class="ui-block-a"><div class="brk11_3">
			<img src="images/milk.fw.png" class="image11">
			<div class="brk_name">哺乳室</div>
			</div></div></a>

			<a href="#listpage" data-tag="hospital"><div class="ui-block-b"><div class="brk11">

			<img src="images/hospital.fw.png" class="image11">
			<div class="brk_name">醫療院所</div>	

			</div> </div></a>

			<a href="#listpage" data-tag="health"><div class="ui-block-a"> <div class="brk11_2">

			<img src="images/health.fw.png" class="image11">
			<div class="brk_name">衛生局</div>	


			</div></div></a>

			<a href="#listpage" data-tag="stroller"><div class="ui-block-b"> <div class="brk11_5">

			<img src="images/stroller.fw.png" class="image11">
			<div class="brk_name">社區保母</div>	

			</div></div></a>

	</div>

	<a href="#vaccinepage" ><div class="ui-block-b">
		 <div class="brk22"><img src="images/vaccine.fw.png" class="image22"><div class="brk_name2">接種疫苗</div>	
	 </div> </a>


	</div>
</div>



<div class="ui-grid-a">

		<div class="ui-block-a">  <div class="brk22_2">

			<img src="images/home.fw.png" class="image22">
			<div class="brk_name2">居家護理所</div>	

		</div> 	</div>

	<div class="ui-block-b">
		
		<div class="ui-grid-solo"> <div class="brk11">
			<img src="images/health.fw.png" class="image11">
			<div class="brk_name">托嬰中心</div>	
		</div> </div>
		<div class="ui-block-a"> <div class="brk11_2">
			<img src="images/health.fw.png" class="image11">
			<div class="brk_name">我的最愛</div>	
		</div> </div>
		<div class="ui-block-b"> <div class="brk11_3">
			<img src="images/health.fw.png" class="image11">
			<div class="brk_name">關於</div>	
		</div> </div>

	</div>


</div>





<div class="ui-grid-solo">  <div class="brk11_4">
	
			

</div>  </div>

   </div>
</div>









<!-- home page 以 ListView 顯示全部景點清單 -->
<div data-role="page" id="listpage" data-theme="a">
  <div data-role="header" data-position="fixed" data-theme="b" >
      <a data-rel="back" data-role="button">返回</a>
      <h1>標題(這邊寫script改)</h1>
  </div>


  <div data-role="content">
     <div id="entries"><ul id="recent" data-role="listview" data-filter="true" data-filter-placeholder="搜尋景點" ></ul></div>

  </div>

  <div data-role="footer" data-position="fixed" data-theme="b">
	  <div data-role="navbar" >
      <ul >
        <li><a href="#" id="btn_showhome2" data-icon="arrow-r" data-iconpos="top" class="ui-btn-active">List</a></li>
        <li><a href="#mappage" id="btn_showmap2" data-icon="bars" data-iconpos="top">Map</a></li> 
      </ul>
      </div>
  </div>


</div>









<!-- mappage page 顯示Google 地圖 -->
<div data-role="page" id="mappage" data-theme="a">
  <div data-role="header" data-position="fixed" data-theme="b">
      <a href="" data-icon="delete" id="end" class="ui-btn-right" data-iconpos="notext">結束</a>
      <h1>Google Map</h1>
  </div>
  <div data-role="content" style="padding:0px">
	<input id="btnGetCenter" type="button" value="中心"/>
	<div id="map_div"></div>
      <p></p>
	  <p id="msg"><p>
  </div>


  <div data-role="footer" data-position="fixed" data-theme="b">
	  <div data-role="navbar" >
      <ul >
        <li><a href="#" id="btn_showmap2" data-icon="bars" data-iconpos="top" class="ui-btn-active">List</a></li>
        <li><a href="#listpage" id="btn_showhome2" data-icon="arrow-r" data-iconpos="top" >Map</a></li> 
      </ul>
      </div>
  </div>



</div>






<!-- vaccinepage 以 ListView 顯示全部疫苗清單 -->
<div data-role="page" id="vaccinepage" data-theme="a">
  <div data-role="header" data-position="fixed" data-theme="a" >
      <a data-rel="back" data-role="button">返回</a>
      <h1>接種疫苗</h1>
  </div>


  <div data-role="content">
  	<a id='lnkDialog' href="#birthdayDialog" data-rel="dialog" data-transition="pop" style='display:none;'></a>
     <div id="entries2">
     <ul id="vaccineList" data-role="listview" data-filter="true" data-filter-placeholder="搜尋疫苗" ></ul>
     </div>
  </div>

</div>






<!-- 詢問對話框 -->
<div data-role="page" id="selectDialog">
	<div data-role="content">
		<a href="index.html" data-tag="navigation" data-role="button" data-icon="grid">導航</a> 
		<a href="index.html" data-tag="phonecall" data-role="button" data-icon="info">撥號</a> 
	</div>
</div>





<!-- 註冊寶寶出生年月日資訊對話框 -->
<div data-role="page" id="birthdayDialog">
	<div data-role="content">
		<label for="text-basic">寶寶名稱</label>
		<input type="text" name="text-basic" id="babyname" value="">
		<label for="date"請選擇寶寶出生日期</label>
		<input type="date" name="date" id="babybirthday" value="">
		<a href="#" data-role="button" data-theme="a" id="submit">完成</a>
		<a href="#" data-role="button">離開</a>
	</div>
</div>












</body>

</html>